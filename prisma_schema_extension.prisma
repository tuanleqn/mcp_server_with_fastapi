// Add these models to your existing schema.prisma file
// This extends your existing company and stock_price models with user authentication

model users {
  id              Int      @id @default(autoincrement())
  username        String   @unique @db.VarChar(50)
  email           String   @unique @db.VarChar(100)
  password_hash   String   @db.VarChar(64)
  full_name       String?  @db.VarChar(100)
  created_at      DateTime @default(now()) @db.Timestamptz
  updated_at      DateTime @updatedAt @db.Timestamptz
  is_active       Boolean  @default(true)
  is_admin        Boolean  @default(false)
  role            String   @default("user") @db.VarChar(20)
  
  // Relations
  stock_holdings  user_stock_holdings[]
  watchlists      user_watchlists[]
  sessions        user_sessions[]
  audit_logs      user_audit[]
  
  @@map("users")
}

model user_stock_holdings {
  id             Int      @id @default(autoincrement())
  user_id        Int
  symbol         String   @db.VarChar(10)
  quantity       Int
  purchase_price Decimal  @db.Decimal(12, 4)
  purchase_date  DateTime @db.Date
  created_at     DateTime @default(now()) @db.Timestamptz
  updated_at     DateTime @updatedAt @db.Timestamptz
  
  // Relations
  user           users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  company        company  @relation(fields: [symbol], references: [symbol], onDelete: Cascade)
  
  @@unique([user_id, symbol])
  @@map("user_stock_holdings")
}

model user_watchlists {
  id       Int      @id @default(autoincrement())
  user_id  Int
  symbol   String   @db.VarChar(10)
  added_at DateTime @default(now()) @db.Timestamptz
  notes    String?
  
  // Relations
  user     users   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  company  company @relation(fields: [symbol], references: [symbol], onDelete: Cascade)
  
  @@unique([user_id, symbol])
  @@map("user_watchlists")
}

model user_sessions {
  id           Int      @id @default(autoincrement())
  user_id      Int
  session_token String  @unique @db.VarChar(255)
  expires_at   DateTime @db.Timestamptz
  created_at   DateTime @default(now()) @db.Timestamptz
  last_accessed DateTime @default(now()) @db.Timestamptz
  ip_address   String?  @db.Inet
  user_agent   String?
  
  // Relations
  user         users   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  
  @@map("user_sessions")
}

model user_audit {
  id            Int      @id @default(autoincrement())
  user_id       Int?
  action        String   @db.VarChar(50)
  resource_type String?  @db.VarChar(50)
  resource_id   String?  @db.VarChar(100)
  details       Json?
  ip_address    String?  @db.Inet
  user_agent    String?
  created_at    DateTime @default(now()) @db.Timestamptz
  
  // Relations
  user          users?  @relation(fields: [user_id], references: [id], onDelete: SetNull)
  
  @@map("user_audit")
}

// Update your existing company model to include the new relations
// Add these lines to your existing company model:
// stock_holdings  user_stock_holdings[]
// watchlists      user_watchlists[]
